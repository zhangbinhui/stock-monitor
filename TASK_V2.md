# ä»»åŠ¡V2ï¼šåŠ¨æ€æ ¸å¿ƒæŒ‡æ ‡è·Ÿè¸ªï¼ˆè¦†ç›–TASK.mdï¼‰

## æ ¸å¿ƒç†å¿µå˜æ›´
~~æ ¸å¿ƒæŒ‡æ ‡å†™æ­»åœ¨ portfolio.json é‡Œ~~ â†’ **ç³»ç»Ÿæ ¹æ®è‚¡ç¥¨ç±»å‹+å½“å‰çŠ¶æ€è‡ªåŠ¨æ¨æ–­è¦è·Ÿè¸ªä»€ä¹ˆ**

### åŠ¨æ€é€»è¾‘
1. **æ–°è‚¡ç¥¨åŠ å…¥æŒä»“** â†’ è‡ªåŠ¨æ ¹æ®æ—å¥‡åˆ†ç±»ç”Ÿæˆå¯¹åº”çš„æ ¸å¿ƒè·Ÿè¸ªæŒ‡æ ‡
2. **æ•°æ®æ›´æ–°åè‡ªåŠ¨æ»šåŠ¨** â†’ æ¯”å¦‚2æœˆäº§é”€å‡ºäº†ï¼Œè‡ªåŠ¨å¼€å§‹ç­‰3æœˆçš„
3. **å‚¬åŒ–å‰‚åˆ°æœŸè‡ªåŠ¨æ›´æ–°** â†’ å¹´æŠ¥å‘å¸ƒåï¼Œå‚¬åŒ–å‰‚è‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼ˆæ¯”å¦‚Q1æŠ¥ï¼‰

### ä¸åŒåˆ†ç±»çš„é»˜è®¤æŒ‡æ ‡æ¨¡æ¿

#### æˆé•¿è‚¡
- æœ€æ–°å­£åº¦/å¹´åº¦æŠ¥å‘Šæ˜¯å¦å‘å¸ƒï¼ˆè‡ªåŠ¨ç®—ä¸‹ä¸€ä»½æŠ¥å‘Šçš„é¢„è®¡æ—¶é—´ï¼‰
- è¥æ”¶/åˆ©æ¶¦å¢é€Ÿè¶‹åŠ¿ï¼ˆå·²æœ‰ï¼‰
- é«˜ç®¡å¢å‡æŒåŠ¨æ€ï¼ˆå·²æœ‰å…¬å‘Šæ‰«æï¼Œå¢å¼ºï¼‰

#### å‘¨æœŸè‚¡
- æ ¸å¿ƒäº§å“ä»·æ ¼èµ°åŠ¿ï¼ˆæ ¹æ®è¡Œä¸šè‡ªåŠ¨åŒ¹é…ï¼šå‘³ç²¾ã€èµ–æ°¨é…¸ç­‰ï¼‰
- åˆ©æ¶¦æ‹ç‚¹æ–¹å‘ï¼ˆå·²æœ‰ï¼‰
- åŸææ–™æˆæœ¬è¶‹åŠ¿

#### ä»·å€¼è‚¡
- è‚¡æ¯ç‡/åˆ†çº¢æ–¹æ¡ˆï¼ˆè·Ÿè¸ªå¹´æŠ¥å‘å¸ƒï¼‰
- å‡€æ¯å·®è¶‹åŠ¿ï¼ˆé“¶è¡Œï¼‰
- PE/PBå˜åŒ–

#### å›°å¢ƒåè½¬è‚¡
- æœˆåº¦ç»è¥æ•°æ®ï¼ˆäº§é”€å¿«æŠ¥ç­‰ï¼Œè‡ªåŠ¨æ£€æµ‹æœ€æ–°ä¸€æœŸå¹¶æ»šåŠ¨åˆ°ä¸‹ä¸€æœŸï¼‰
- æ¯›åˆ©ç‡è¶‹åŠ¿ï¼ˆå·²æœ‰ï¼‰
- å…³é”®æ–°äº§å“/æ–°ä¸šåŠ¡è¿›å±•

#### æŒ‡æ•°ETF
- å…³è”èµ„é‡‘æµå‘ï¼ˆå—å‘/åŒ—å‘ï¼‰
- æˆåˆ†è‚¡ä¸šç»©å­£è¿›å±•

#### ä»£æŒ/è·Ÿéš
- ä¸åšè·Ÿè¸ªï¼Œåªæ˜¾ç¤º"è·Ÿéšæ“ç›˜æ‰‹æŒ‡ä»¤"

### å®ç°æ–¹æ¡ˆ

#### æ–°å¢ `core_indicators.py`

```python
class IndicatorEngine:
    """åŠ¨æ€æ ¸å¿ƒæŒ‡æ ‡å¼•æ“"""
    
    def generate_indicators(self, holding: dict, fundamentals: dict) -> List[Indicator]:
        """
        æ ¹æ®æŒä»“çš„ stock_class + è¡Œä¸š + å½“å‰çŠ¶æ€ï¼Œè‡ªåŠ¨ç”Ÿæˆéœ€è¦è·Ÿè¸ªçš„æŒ‡æ ‡åˆ—è¡¨
        - holding: portfolio.json ä¸­çš„æŒä»“é…ç½®
        - fundamentals: analyze_portfolio å·²è·å–çš„åŸºæœ¬é¢æ•°æ®
        è¿”å›: æŒ‡æ ‡åˆ—è¡¨ï¼Œæ¯ä¸ªæŒ‡æ ‡åŒ…å« {name, value, status, display_text}
        """
        stock_class = holding.get('stock_class', '')
        if stock_class == 'æˆé•¿è‚¡':
            return self._growth_stock_indicators(holding, fundamentals)
        elif stock_class == 'å‘¨æœŸè‚¡':
            return self._cyclical_stock_indicators(holding, fundamentals)
        # ... ç­‰ç­‰

    def _growth_stock_indicators(self, holding, fundamentals):
        indicators = []
        # 1. ä¸‹ä¸€ä»½è´¢æŠ¥ç›‘æ§ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
        indicators.append(self._next_report_indicator(holding['code']))
        # 2. å¢é€Ÿè¶‹åŠ¿å·²åœ¨ä¸»æµç¨‹ï¼Œä¸é‡å¤
        return indicators
    
    def _next_report_indicator(self, code):
        """è‡ªåŠ¨åˆ¤æ–­ä¸‹ä¸€ä»½è¯¥å‡ºçš„æŠ¥å‘Šï¼ˆå¹´æŠ¥/å­£æŠ¥ï¼‰ï¼Œæ£€æŸ¥æ˜¯å¦å·²å‘å¸ƒ"""
        # æ ¹æ®å½“å‰æ—¥æœŸæ¨ç®—ï¼š
        # 1-4æœˆ â†’ ç­‰å¹´æŠ¥
        # 4-8æœˆ â†’ ç­‰åŠå¹´æŠ¥ æˆ– Q1æŠ¥
        # 8-10æœˆ â†’ ç­‰Q3æŠ¥
        # ç”¨å·¨æ½®APIæ£€æŸ¥æ˜¯å¦å·²å‘å¸ƒ
        pass

    def _monthly_ops_indicator(self, code, company_name):
        """æœˆåº¦ç»è¥æ•°æ®ï¼ˆäº§é”€å¿«æŠ¥ç­‰ï¼‰"""
        # æœç´¢å·¨æ½®å…¬å‘Šï¼Œæ‰¾æœ€æ–°ä¸€æœŸäº§é”€/ç»è¥æ•°æ®
        # è¿”å›æœ€æ–°æ•°æ® + ä¸‹ä¸€æœŸé¢„è®¡æ—¶é—´
        pass
    
    def _commodity_price_indicator(self, industry, products):
        """è¡Œä¸šç›¸å…³å¤§å®—å•†å“ä»·æ ¼"""
        # æ ¹æ®è¡Œä¸šè‡ªåŠ¨åŒ¹é…è¦è·Ÿè¸ªçš„å•†å“
        pass
    
    def _southbound_flow_indicator(self):
        """å—å‘èµ„é‡‘æµ"""
        pass
```

#### portfolio.json æ”¹é€ 
å»æ‰æ‰‹å†™çš„ `core_track` å’Œ `next_catalyst` å­—ç¬¦ä¸²å­—æ®µã€‚
åªä¿ç•™ä¸€ä¸ªå¯é€‰çš„ `indicator_hints` ç”¨äºç‰¹æ®Šè¦†ç›–ï¼š

```json
{
  "code": "600873",
  "name": "æ¢…èŠ±ç”Ÿç‰©",
  "stock_class": "å‘¨æœŸè‚¡",
  "indicator_hints": {
    "products": ["å‘³ç²¾", "èµ–æ°¨é…¸", "è‹æ°¨é…¸"],
    "cost_driver": "ç‰ç±³"
  }
}
```

å¤§éƒ¨åˆ†æƒ…å†µä¸éœ€è¦ hintsï¼Œå¼•æ“è‡ªåŠ¨æ¨æ–­ã€‚hints åªç”¨äºå¼•æ“æ— æ³•è‡ªåŠ¨åˆ¤æ–­çš„æƒ…å†µï¼ˆæ¯”å¦‚æ¢…èŠ±ç”Ÿç‰©å…·ä½“è·Ÿè¸ªå“ªå‡ ä¸ªäº§å“ï¼‰ã€‚

#### portfolio_monitor.py é›†æˆ
åœ¨ analyze_portfolio çš„å¾ªç¯ä¸­ï¼š
```python
engine = IndicatorEngine()
for h in holdings:
    # ... ç°æœ‰é€»è¾‘ ...
    # æ–°å¢ï¼šåŠ¨æ€æŒ‡æ ‡
    indicators = engine.generate_indicators(h, fundamentals_data)
    result['core_indicators'] = indicators
```

format_report ä¸­å±•ç¤ºï¼š
```
ğŸ” å‘³ç²¾: 5800å…ƒ/å¨(æœˆ+3%) | èµ–æ°¨é…¸: 8200å…ƒ/å¨(æœˆ-1%)
ğŸ“… å‚¬åŒ–: å¹´æŠ¥é¢„è®¡3/20 | ä¸‹æœŸäº§é”€å¿«æŠ¥: 3æœˆåˆ
```

### æ•°æ®æºä¼˜å…ˆçº§
1. akshareï¼ˆä¼˜å…ˆï¼Œå·²å®‰è£…ï¼‰
2. å·¨æ½®APIï¼ˆå…¬å‘Šæœç´¢ï¼Œå·²åœ¨ç”¨ï¼‰
3. ç”Ÿæ„ç¤¾ 100ppi.comï¼ˆå•†å“ä»·æ ¼å¤‡é€‰ï¼Œéœ€çˆ¬è™«ï¼‰

### ç¼“å­˜ç­–ç•¥
- `indicator_cache.json`ï¼šæ¯ä¸ªæŒ‡æ ‡æŒ‰ key+æ—¥æœŸ ç¼“å­˜
- åŒä¸€äº¤æ˜“æ—¥å†…ä¸é‡å¤è¯·æ±‚åŒä¸€æ•°æ®
- éäº¤æ˜“æ—¥ç”¨ä¸Šä¸€äº¤æ˜“æ—¥æ•°æ®

### é”™è¯¯å¤„ç†
- å•ä¸ªæŒ‡æ ‡æŠ“å–å¤±è´¥ â†’ æ˜¾ç¤º"æ•°æ®è·å–ä¸­..."ï¼Œä¸å½±å“å…¶ä»–
- æ•´ä¸ªå¼•æ“å¼‚å¸¸ â†’ fallback åˆ°ä¸æ˜¾ç¤ºæ ¸å¿ƒæŒ‡æ ‡ï¼Œæ—¥æŠ¥å…¶ä»–éƒ¨åˆ†æ­£å¸¸

### éªŒè¯
```bash
source .venv_new/bin/activate
python portfolio_monitor.py --mode daily --stdout
```

å®Œæˆåè¿è¡Œ:
```bash
openclaw system event --text "Done: åŠ¨æ€æ ¸å¿ƒæŒ‡æ ‡è·Ÿè¸ªæ¨¡å—å®Œæˆ" --mode now
```
